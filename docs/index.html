<!DOCTYPE html>

<title>ModelCraft</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="Paul Bond" />
<meta name="description" content="Automated model building pipeline for X-ray crystallography" />

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,300,600" />
<link rel="stylesheet" href="css/normalize.min.css" />
<link rel="stylesheet" href="css/skeleton.min.css" />
<link rel="stylesheet" href="css/custom.css" />

<div class="container">
    <img src="img/modelcraft.png" alt="Logo" class="logo">

    <h1>ModelCraft</h1>
    <h5>An automated model building pipeline for X-ray crystallography</h5>

    <nav>
        <ol>
            <li><a href="#getting-started">Getting Started</a></li>
            <li><a href="#required-arguments">Required Arguments</a></li>
            <li><a href="#optional-arguments">Optional Arguments</a></li>
            <li><a href="#developer-arguments">Developer Arguments</a></li>
            <li><a href="#contents">ASU Contents Description</a></li>
            <li><a href="#links">Links</a></li>
            <li><a href="#citations">Citations</a></li>
        </ol>
    </nav>

    <section id="getting-started">
        <h2 class="heading">Getting Started</h2>
        <p>ModelCraft can be installed using pip, e.g.</p>
        <pre><code>python3 -m pip install --user modelcraft</code></pre>
        <p>
            Refer to the
            <a href="https://pip.pypa.io/en/stable/installing">pip documentation</a>
            if pip is not installed.
            ModelCraft also requires an installation of CCP4.
            The CCP4 environment needs to be set up
            so that programs such as Buccaneer and Refmac
            can be called from the command line.
            The simplest execution requires only
            a reflection data file in MTZ format
            (with observations, a free-R flag and starting phases)
            and a description of the asymmetric unit contents.
        </p>
        <pre><code>modelcraft --data data.mtz --contents contents.json</code></pre>
        <p>
            Alternatively, a model can be provided (in PDB or mmCIF format),
            which will be refined and used as a starting point
            instead of starting from phases in the data file.
        </p>
        <pre><code>modelcraft --data data.mtz --contents contents.json --model model.cif</code></pre>
    </section>

    <section id="required-arguments">
        <h2 class="heading">Required Arguments</h2>
        <p>
            <code>--data FILE</code><br>
            Input reflection data in MTZ format.
            This must contain observations and a free-R flag.
            If a starting model has not been provided then it must also contain phases
            as a phase and figure-of-merit or Hendrickson-Lattman coefficients.
            An attempt will be made to automatically identify column labels
            unless they are specified using the
            <code>--observations</code>,
            <code>--phases</code> and
            <code>--freerflag</code> arguments.
        </p>
        <p>
            <code>--contents FILE</code><br>
            A description of the assymetric unit contents,
            either as a sequence file (in FASTA or PIR format)
            or a more detailed contents file in JSON format.
            See the <a href="#contents">ASU Contents Description</a>
            section of the documentation for more details.
        </p>
    </section>

    <section id="optional-arguments">
        <h2 class="heading">Optional Arguments</h2>
        <p>
            <code>--basic</code><br>
            Run a basic pipeline using only Buccaneer and Refmac.
            Parrot density modification is still used on the first cycle
            and input models are still refined using Sheetbend and Refmac.
        </p>
        <p>
            <code>--convergence-cycles N</code> default: <code>4</code><br>
            Number of cycles without improvement
            needed to stop the pipeline automatically.
            <code>--convergence-tolerance</code> is used to determine whether
            a cycle gave an improvement.
        </p>
        <p>
            <code>--convergence-tolerance</code> default: <code>0.1</code><br>
            R-free difference needed to mark a cycle as an improvement.
            If the model at the end of a cycle
            has an R-free that is this much better than the previous best R-free
            then the cycle is marked as an improvement.
            <code>--convergence-cycles</code> states
            how many cycles without improvement are needed to stop automatically.
        </p>
        <p>
            <code>--cycles N</code> default: <code>25</code><br>
            Maximum number of pipeline cycles.
        </p>
        <p>
            <code>--freerflag COL</code> e.g. <code>FreeR_flag</code><br>
            Column label for the free-R flag.
        </p>
        <p>
            <code>--help</code><br>
            Show an automatically generated help message.
        </p>
        <p>
            <code>--keep-jobs</code><br>
            Keep the files from intermediate jobs instead of deleting them.
            This can lead to large directory sizes.
        </p>
        <p>
            <code>--keep-logs</code><br>
            Keep log files if not using the full <code>--keep-jobs</code> argument.
        </p>
        <p>
            <code>--model FILE</code><br>
            Starting model.
            If input phases are not specified this will be refined
            using Sheetbend followed by Refmac.
        </p>
        <p>
            <code>--no-auto-stop</code><br>
            Run the maximum number of cycles even if the model is not improving.
        </p>
        <p>
            <code>--observations COLS</code> e.g. <code>FP,SIGFP</code><br>
            Column labels for the observations
            as either amplitudes or intensities
            (both can be mean or anomalous).
        </p>
        <p>
            <code>--phases COLS</code>
            e.g. <code>PHIB,FOM</code> or <code>HLA,HLB,HLC,HLD</code><br>
            Column labels for input phases as either
            a phase and figure of merit or Hendrickson-Lattman coefficients.
        </p>
        <p>
            <code>--twinned</code><br>
            Turn on twinned refinement.
            Only do this if you are sure your data are twinned.
        </p>
        <p>
            <code>--unbiased</code><br>
            Pass input phases to Refmac for MLHL refinement.
        </p>
    </section>

    <section id="developer-arguments">
        <h2 class="heading">Developer Arguments</h2>
        <p>
            <code>--buccaneer FILE</code><br>
            Path to an alternative buccaneer executable.
        </p>
        <p>
            <code>--parrot FILE</code><br>
            Path to an alternative parrot executable.
        </p>
        <p>
            <code>--sheetbend FILE</code><br>
            Path to an alternative sheetbend executable.
        </p>
    </section>

    <section id="contents">
        <h2 class="heading">ASU Contents Description</h2>
        <p>
            A description of the expected contents of the asymmetric unit
            must be provided as a FASTA sequence file or a JSON file
            using the <code>--contents</code> argument.
            A sequence file is simpler,
            but the JSON format has the following advantages:
        </p>
        <ul>
            <li>Number of copies and stoichiometry can be specified
                for a more accurate calculation of the solvent fraction.</li>
            <li>Carbohydrates, ligands and buffers may be specified
                in addition to protein, RNA and DNA.</li>
            <li>Molecule types do not need to be guessed from
                sequences (which may be ambiguous).</li>
        </ul>
        <p>
            In order to create a JSON file it may be helpful
            to start from the contents for an existing PDB entry.
            The <code>modelcraft-contents</code> script
            creates a contents JSON file for a released PDB entry.
        </p>
        <p>An example JSON file is shown below:</p>
        <pre><code>{
    "copies": 2,
    "proteins": [
        {
            "sequence": "LPGECSVNVIPKMNLDKAKFFSGTWYETHYLDMDPQATEKFCFSFAPRESGGTVMEALYHFNVDSKV",
            "stoichiometry": 1,
            "modifications": ["M->MSE"]
            "start": 1,
        },
        {
            "sequence": "GGG"
        }
    ],
    "rnas": [
        {
            "sequence": "GGUAACUGUUACAGUUACC",
            "stoichiometry": 2,
            "modifications": ["5->GTP", "23->CCC"]
            "start": 5,
        }
    ],
    "dnas": [],
    "carbs": [
        { "codes": { "NAG": 2 }, "stoichiometry": 1 },
        { "codes": { "MAN": 1, "NAG": 2 }, "stoichiometry": 1 }
    ],
    "ligands": [
        { "code": "HEM", "stoichiometry": 1 }
    ],
    "buffers": ["GOL", "NA", "CL"]
}</code></pre>
        <p>
            The file has a list of <code>proteins</code>, <code>rnas</code>,
            <code>dnas</code>, <code>carbs</code>, <code>ligands</code>,
            and <code>buffers</code> that are in the crystal.
            The only mandatory items are that each 
            protein, RNA or DNA chain must have a <code>sequence</code>,
            each carbohydrate must have a dictionary of <code>codes</code>
            to specify the number of each sugar,
            and each ligand must have a single <code>code</code>.
        </p>
        <p>
            Each component (other than buffers) has a
            <code>stoichiometry</code> parameter to specify the stoichiometry.
            In the example above there are 2 RNA chains for each protein chain.
            If the stoichiometry is not specified it is assumed to be 1.
            There is also a <code>copies</code> parameter for the whole file
            to specify how many copies of the contents are in the asymmetric unit.
            If this value is not known the most likely number will be estimated.
            The <code>modelcraft-copies</code> script can be used to
            view the solvent fraction and probability for each number of copies
            given a contents file and an MTZ file.
            It is assumed that the number of ordered buffer molecules is unknown
            so they are not included in the solvent calculation.
        </p>
        <p>
            Finally, protein, RNA and DNA chains may have
            a list of <code>modifications</code>,
            e.g. <code>M->MSE</code> to specify that
            all methionine residues are actually selenomethionine
            or <code>5->GTP</code> to specify that
            the residue 5 is guanosine triphosphate.
            The <code>start</code> property
            changes the residue numbers in modifications,
            e.g. residue 5 in the RNA chain is actually the first residue.
        </p>
        <p>
            <b>Note:</b> ModelCraft does not yet build carbohydrates, ligands,
            or modified residues (other than selenomethionine derivatives).
            However, this is planned for the future
            and inclusion of these components in the contents
            allows for more accurate calculation of the solvent fraction
            during density modification.
        </p>
    </section>

    <section id="links">
        <h2 class="heading">Links</h2>
        <ul>
            <li>
                <a href="https://github.com/paulsbond/modelcraft">
                    Source (latest)
                </a>
            </li>
            <li>
                <a href="https://github.com/paulsbond/modelcraft/releases">
                    Source (releases)
                </a>
            </li>
            <li>
                <a href="https://github.com/paulsbond/modelcraft/issues">
                    Issues (e.g. bugs and feature requests)
                </a>
            </li>
            <li>
                <a href="https://pypi.org/project/modelcraft/">
                    PyPI (Python Package Index)
                </a>
            </li>
        </ul>
    </section>

    <section id="citations">
        <h2 class="heading">Citations</h2>
        <dl>
            <dt>ModelCraft</dt>
            <dd><i>Publication in progress</i></dd>
            <dt>Buccaneer</dt>
            <dd>
                K Cowtan.
                <i>Acta Cryst. D</i>, <b>62</b>, 1002 (2006)
                <a href="https://doi.org/10.1107/S0907444906022116">DOI</a>
            </dd>
            <dt>Coot</dt>
            <dd>
                P Emsley, B Lohkamp, WG Scott, K Cowtan.
                <i>Acta Cryst. D</i>, <b>66</b>, 486 (2010)
                <a href="https://doi.org/10.1107/S0907444910007493">DOI</a>
            </dd>
            <dt>Nautilus</dt>
            <dd>
                K Cowtan.
                <i>IUCrJ</i>, <b>1</b>, 387 (2014)
                <a href="https://doi.org/10.1107/S2052252514019290">DOI</a>
            </dd>
            <dt>Parrot</dt>
            <dd>
                K Cowtan.
                <i>Acta Cryst. D</i>, <b>66</b>, 470 (2010)
                <a href="https://doi.org/10.1107/S090744490903947X">DOI</a>
            </dd>
            <dt>Refmac</dt>
            <dd>
                O Kovalevskiy, RA Nicholls, F Long, A Carlon, GN Murshudov.
                <i>Acta Cryst. D</i>, <b>74</b>, 215 (2018)
                <a href="https://doi.org/10.1107/S2059798318000979">DOI</a>
            </dd>
            <dt>Sheetbend</dt>
            <dd>
                K Cowtan, S Metcalfe, P Bond.
                <i>Acta Cryst. D</i>, <b>76</b>, 1192 (2020)
                <a href="https://doi.org/10.1107/S2059798320013170">DOI</a>
            </dd>
        </dl>
    </section>

</div>
